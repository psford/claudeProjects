%% MANUAL - Update when API flow changes
sequenceDiagram
    participant U as Browser
    participant A as API
    participant SDS as StockDataService
    participant NS as NewsService
    participant AS as AnalysisService
    participant YF as Yahoo Finance
    participant FH as Finnhub

    U->>A: GET /api/stock/AAPL
    A->>SDS: GetStockInfoAsync("AAPL")
    SDS->>YF: Fetch quote data
    YF-->>SDS: Stock info
    A->>NS: GetCompanyProfileAsync("AAPL")
    NS->>FH: Fetch profile
    FH-->>NS: Company profile (ISIN, CUSIP)
    A-->>U: Enriched stock info

    U->>A: GET /api/stock/AAPL/history
    A->>SDS: GetHistoricalDataAsync("AAPL", "1y")
    SDS->>YF: Fetch OHLCV data
    YF-->>SDS: Historical prices
    A-->>U: Price history

    U->>A: GET /api/stock/AAPL/analysis
    A->>AS: CalculateMovingAverages()
    A->>AS: CalculateRsi()
    A->>AS: CalculateMacd()
    A-->>U: Technical indicators
